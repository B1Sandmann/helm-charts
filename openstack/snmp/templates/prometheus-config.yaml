apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus

data:
  prometheus.yaml: |
    global:
      scrape_timeout: 55s

    scrape_configs:
    - job_name: snmp-baremetal
      file_sd_configs:
        - files:
          - /etc/snmp_exporter/targets.json
          refresh_interval: 1m
      metrics_path: /snmp
      relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - source_labels: [__param_module]
        target_label: module
      - target_label: __address__
        replacement: "{{ .Chart.Name }}:{{ .Values.snmp_exporter.service.port }}"
