{{- if .Values.postgresql.useOperator }}
apiVersion: "acid.zalan.do/v1"
kind: postgresql
metadata:
  name: keystone-db
spec:
  teamId: "keystone"
  enableMasterLoadBalancer: false
  enableReplicaLoadBalancer: false

  allowedSourceRanges: # load balancers' source ranges for both master and replica services
  - 127.0.0.1/32

  postgresql:
    version: "10"
    parameters:
      max_connections: "100"
      log_statement: "all"

  patroni:
    initdb:
      encoding: "UTF8"
      locale: "en_US.UTF-8"
      data-checksums: "true"

    pg_hba:
    - hostssl all all 0.0.0.0/0 md5
    - host    all all 0.0.0.0/0 md5
    - hostnossl all all 0.0.0.0/0 md5

    ttl: 30
    loop_wait: &loop_wait 10
    retry_timeout: 10

  volume:
    size: 1Gi

  numberOfInstances: 2

  users:
    # database owner
    keystone:
    - superuser
    - createdb

  #databases: name->owner
  databases:
    keystone: keystone

{{- end }}