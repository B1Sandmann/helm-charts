{{ if and .Values.cert_issuer .Values.cert_issuer.enabled -}}
apiVersion: certmanager.k8s.io/v1alpha1
kind: Issuer
metadata:
  name: acme-cert-issuer
  namespace: kube-system
spec:
  acme:
    server: {{ required "missing acme server" .Values.cert_issuer.acme.server | quote }}
    email: {{ required "missing acme email" .Values.cert_issuer.acme.email | quote }}
    privateKeySecretRef:
      name: {{ default "cert-manager-secret" .Values.cert_issuer.acme.secretName | quote }}
    dns01:
      # list of DNS-01 providers that can solve DNS challenges
      providers:
      - name: designate
        designate:
          authURL: {{ required "missing openstack authURL" .Values.cert_issuer.designate.authURL | quote }}
          regionName: {{ required "missing openstack regionName" .Values.cert_issuer.designate.regionName | quote }}
          userName: {{ required "missing openstack userName" .Values.cert_issuer.designate.userName | quote }}
          userDomainName: {{ required "missing openstack userDomainName" .Values.cert_issuer.designate.userDomainName | quote }}
          projectName: {{ required "missing openstack projectName" .Values.cert_issuer.designate.projectName | quote }}
          projectDomainName: {{ required "missing openstack projectDomainName" .Values.cert_issuer.designate.projectDomainName | quote }}
          zoneName: {{ required "missing openstack zoneName" .Values.cert_issuer.designate.zoneName | quote }}
          authPasswordSecretRef:
            name: cert-manager-issuer-secret
            key: authPassword
{{- end }}