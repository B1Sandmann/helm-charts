{{ if .Values.enabled }}

apiVersion: v1
kind: ConfigMap

metadata:
  name: cloudprober-config
  labels:
    app: cloudprober-exporter
    release: "{{$.Release.Name}}"

data:
  cloudprober.cfg: |
    {{ range $i, $config := .Values.ping_targets -}}
    probe {
      type: PING
      name: "probe-{{ $config.name }}"
      targets {
        host_names: "{{ $config.target }}"
      }
      ping_probe {
        use_datagram_socket: false
      }
    }
    {{- end }}

{{ end -}}