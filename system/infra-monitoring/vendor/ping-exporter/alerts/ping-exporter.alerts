groups:
- name: pingexporter.alerts
  rules:
  - alert: NetworkInterconnectExporterNotRunning
    expr: absent(ping_up) or ping_up == 0
    for: 15m
    labels:
      meta: Ping exporter is not running in {{ $labels.region }}
      severity: info
      tier: os
    annotations:
      description: Ping exporter is not running in {{ $labels.region }}
      summary: Ping exporter is not running in {{ $labels.region }}

- name: interconnect.alerts
  rules:
  - alert: NetworkInterconnectDown
    expr: ping_loss_percent == 1
    for: 5m
    labels:
      context: interconnect
#      dashboard: must be a regional
      playbook: /docs/devops/alert/network/interconnect.html
      meta: '{{ $labels.probed_from }} cannot ping target in {{ $labels.probed_to }}'
      service: interconnect
      severity: info
      tier: net
    annotations:
      description: '{{ $labels.probed_from }} cannot ping target in {{ $labels.probed_to }}'
      summary: '{{ $labels.probed_from }} cannot ping target in {{ $labels.probed_to }}'

- name: sre.alerts
  rules:
  - alert: NetworkInterconnectSLOAvailabilityViolated
    expr: (1 - avg_over_time(ping_loss_percent{probed_to_type='server'}[12h])) * 100 < 99.95
    for: 5m
    labels:
      context: sre_interconnect_availability
      dashboard: interconnect-slo-availability
#      playbook: /docs/devops/alert/network/interconnect.html
      meta: 'Datapath availability from {{ $labels.probed_from }} to {{ $labels.probed_to }} violates SLO'
      service: interconnect
      severity: info
      tier: sre
    annotations:
      description: 'Datapath availability from {{ $labels.probed_from }} to {{ $labels.probed_to }} violates SLO'
      summary: 'Datapath availability from {{ $labels.probed_from }} to {{ $labels.probed_to }} violates SLO'