groups:
- name: alerts for PX kubernetes resources
  rules:
  - alert: PXPodNotReady
    expr: sum
      by(pod) ((kube_pod_info{namespace="px"} * on(node) group_left() sum by(node) (kube_node_status_condition{condition="Ready",status="true"})
      * on(pod) group_left() sum by(pod) (kube_pod_status_phase{namespace="px", phase="Running"})
      == 1) * on(pod) group_left() sum by(pod) (kube_pod_status_ready{namespace="px", condition="true"}))
      == 0
    for: 2h
    labels:
      severity: info
      tier: net
      service: px
      context: px
    annotations:
      description: "TEST ALERT - PLEASE IGNORE - Pod px /{{ $labels.pod }} is not ready for more than 2h"
      summary: "TEST ALERT - PLEASE IGNORE - Pod not ready for a long time"

  - alert: PXPodRestartingTooMuch
    expr: sum
      by(pod, container) (rate(kube_pod_container_status_restarts_total{namespace="px"}[15m]))
      > 0
    for: 1h
    labels:
      severity: info
      tier: net
      service: px
      context: px
    annotations:
      description: "TEST ALERT - PLEASE IGNORE - Container {{ $labels.container }} of pod px /{{ $labels.pod }} is restarting constantly"
      summary: "TEST ALERT - PLEASE IGNORE - Pod is in a restart loop"