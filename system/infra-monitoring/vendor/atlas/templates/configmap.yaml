apiVersion: v1
kind: ConfigMap
annotations:
  "helm.sh/hook": "pre-install"
  "helm.sh/hook": "pre-upgrade"

metadata:
  name:  {{ include "atlas.fullname" . }}
  labels:
    app: {{ include "atlas.name" . }}
    chart: {{ include "atlas.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}

data:
  atlas.yaml: |
    discoveries:
      ironic:
        refresh_interval: 600
        targets_file_name: "ironic.json"
        os_auth:
          auth_url: {{ printf "https://identity-3.%s.cloud.sap/v3" .Values.global.region | quote }}
          user: "{{ .Values.global.ipmi_exporter_user }}"
          password: "{{ .Values.global.ipmi_exporter_user_passwd }}"
          user_domain_name: "{{ .Values.os_user_domain_name }}"
          project_name: "{{ .Values.os_project_name }}"
          domain_name: "{{ .Values.os_project_domain_name }}"
      control_plane:
        refresh_interval: 600
        targets_file_name: "control_plane.json"
        netbox_host: "{{ .Values.global.netbox_host }}"
        netbox_api_token: {{ required "netbox_api_token needs to be defined in global values" .Values.global.netbox_api_token }}
      switch:
        refresh_interval: 600
        targets_file_name: "switches.json"
        netbox_host: "{{ .Values.global.netbox_host }}"
        netbox_api_token: {{ required "netbox_api_token needs to be defined in global values" .Values.global.netbox_api_token }}
        dcim:
          - module: "n9k"
            role: "aci-leaf"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            status: "1"
          - module: "n9k"
            role: "aci-spine"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            status: "1"
          - module: "n9k"
            role: "aci-ipn"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            status: "1"

          - module: "f5"
            manufacturer: "f5"
            region: "{{ .Values.global.region }}"
            q: "f5"
            status: "1"
          - module: "asr04"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            q: "asr04"
            status: "1"
          - module: "asr"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            q: "asr01"
            status: "1"
          - module: "asw"
            manufacturer: "arista"
            region: "{{ .Values.global.region }}"
            q: "{{ .Values.global.region }}-asw"
            status: "1"
          - module: "asr"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            q: "{{ .Values.global.region }}-asr"
            status: "1"
          - module: "n7k"
            custom_labels: 
              context: "cc-cloud01,cc-cloud02,cc-cloud03"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            q: "n7k"
            status: "1"
        vm:
          - module: "asa"
            manufacturer: "cisco"
            region: "{{ .Values.global.region }}"
            q: "asa"
            status: "1"
            tag: "admin-context"
