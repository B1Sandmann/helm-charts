{{- if .Values.enabled }}
{{- $scrape := .Values.metrics.scrape -}}
{{- $port := .Values.metrics.port -}}
{{- $targets := .Values.metrics.targets -}}
{{- range $name, $app := .Values.apps }}
{{- if $app.enabled }}
---
kind: Service
apiVersion: v1
metadata:
  name:  {{ $app.fullname }}
  annotations:
    prometheus.io/scrape: {{ $scrape | quote }}
    prometheus.io/port: {{ $port | quote }}
    prometheus.io/targets: {{ $targets | quote }}
spec:
  selector:
    app:  {{ $app.fullname }}
  ports:
  - name:  prometheus
    port:  {{ $port }}
    targetPort: {{ $port }}
{{- end }}
{{- end }}
{{- end }}
